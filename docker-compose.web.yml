# Docker Compose configuration for festas_builds Minecraft Server Website
# This file defines the web service that serves the static website
# The service must join the external 'caddy-network' to be accessible via Caddy reverse proxy

services:
  minecraft-web:
    # Use pre-built image from GitHub Container Registry
    # The image is built and pushed by the GitHub Actions workflow
    image: ghcr.io/festas/minecraft-server-web:latest

    # Container name must match the reverse proxy configuration in Caddy
    container_name: minecraft-web

    # Restart policy
    restart: unless-stopped

    # Join the external Caddy network
    # This network is managed by the Link-in-Bio repository
    networks:
      - caddy-network

    # Map host port 3001 to container port 80
    # nginx reverse proxy will connect to 127.0.0.1:3001
    ports:
      - "3001:80"

    # Health check to ensure the website is responding
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Resource limits (optional but recommended)
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M

# External network managed by Caddy (Link-in-Bio repository)
# This network must already exist before running docker-compose up
networks:
  caddy-network:
    external: true

# Notes:
# 1. The caddy-network must be created before running this compose file
#    If it doesn't exist, create it with: docker network create caddy-network
#
# 2. Configure your nginx reverse proxy to connect to:
#    http://127.0.0.1:3001 for mc.festas-builds.com
#
#    Or add the following to your Caddyfile (in Link-in-Bio repository):
#    mc.festas-builds.com {
#        tls eric@festas-builds.com
#        encode gzip zstd
#        reverse_proxy minecraft-web:80
#    }
#
# 3. To deploy:
#    docker-compose -f docker-compose.web.yml up -d
#
# 4. To view logs:
#    docker-compose -f docker-compose.web.yml logs -f
#
# 5. To pull latest image and restart:
#    docker-compose -f docker-compose.web.yml pull && docker-compose -f docker-compose.web.yml up -d
#
# 6. To stop:
#    docker-compose -f docker-compose.web.yml down
